<!DOCTYPE html>
<html>
    <head>
        <title>Layered Bar Chart</title>
        <script src="https://d3js.org/d3.v4.min.js"></script>
    </head>
    <body>
        <div class="graph"></div>
        <script>
            const dayOfWeekLookup = {
                0: 'Sunday',
                1: 'Monday',
                2: 'Tuesday',
                3: 'Wednesday',
                4: 'Thursday',
                5: 'Friday',
                6: 'Saturday'
            };
 
            function timeInfo(offset) {
                let time = new Date((new Date())*1 + (86400000 * offset));
                return {
                    year: time.getFullYear(),
                    month: time.getMonth() + 1,
                    dayOfMonth: time.getDate(),
                    dayOfWeek: time.getDay()
                };
            }

            let data = [
                {
                    day: timeInfo(0),
                    start: (7 * 3600),
                    end: (17 * 3600)
                },
                {
                    day: timeInfo(1),
                    start: (7 * 3600),
                    end: (17 * 3600)
                },
                {
                    day: timeInfo(2),
                    start: (7 * 3600),
                    end: (17 * 3600)
                },
                {
                    day: timeInfo(3),
                    start: (7 * 3600),
                    end: (17 * 3600)
                },                
                {
                    day: timeInfo(4),
                    start: (7 * 3600),
                    end: (17 * 3600)
                },
                {
                    day: timeInfo(5),
                    start: (9 * 3600),
                    end: (12 * 3600)
                },
                {
                    day: timeInfo(6),
                    start: (9 * 3600),
                    end: (12 * 3600)
                },
            ]

            data = data.reverse()

            let dataDefault = data.map(x => {
                return {day: x.day, start: 0, end: 86400}
            })

            let offset = data.length;

            let height = 500;
            let width = 1000;

            // Setup the X domain time
            const x = d3.scaleLinear()
                .domain([0, (3600 * 24)])
                .range([70, (width - 50)])
            
            // Setup the Y domain days
            const y = d3.scaleBand()
                .domain(data.map(d => dayOfWeekLookup[d.day.dayOfWeek]))
                .rangeRound([height - 25, 50])
                .padding(0.2)

            const xAxis = d3.axisBottom()
                .scale(x)
                .tickValues([1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24]
                    .map(j => j * 3600))
                .tickFormat(j => j / 3600)
                .ticks(24)

            const yAxis = d3.axisLeft().scale(y)

            let chart = d3.select(".graph")
                .append("svg")
                .attr("width", width)
                .attr("height", height)

            // Setup the Axes
            chart.append('g')
                .attr('class', 'x-axis')
                .attr('transform', `translate(0, ${height - 25})`)
                .call(xAxis);

            chart.append('g')
                .attr('class', 'y-axis')
                .attr('transform', 'translate(70, 0)')
                .call(yAxis);
            
            let defaultBar = chart.selectAll('rect')
                .data(dataDefault)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.start))
                .attr('y', d => y(dayOfWeekLookup[d.day.dayOfWeek]))
                .attr('width', d => x(d.end) - 70)
                .attr('height', y.bandwidth())
                .attr('fill', 'steelblue')
            
            data = dataDefault.concat(data)

            let bar2 = chart.selectAll('rect')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar')
                .attr('x', d => x(d.start))
                .attr('y', d => y(dayOfWeekLookup[d.day.dayOfWeek]))
                .attr('width', d => {
                    console.log(`START ${d.start}`)
                    console.log(`END ${d.end}`)
                    console.log(`SUBTRACTION ${d.end - d.start}`)
                    console.log(`SUBTRACTION HOUR ${(d.end - d.start) / 3600}`)
                    // FIXME - Why do I have a two hour difference
                    return x(d.end - d.start) - 70
                })
                .attr('height', y.bandwidth())
                .attr('fill', 'pink')

            let bar3 = chart.selectAll('rect')
                .data(data)
                .enter()
                .append('rect')
                .attr('class', 'bar2')
                .attr('x', 800)
                .attr('y', d => y(dayOfWeekLookup[d.day.dayOfWeek]))
                .attr('width', 200)
                .attr('height', y.bandwidth())
                .attr('fill', 'orange')

        </script>
    </body>
</html>